/*
 * KNSoft.NDK NT version control
 *
 * NT_VERSION: Make NT version number (ULONG)
 * NT_VERSION_*: NT version numbers
 * NT_VERSION_MIN: Minimum support NT version, can be set by user and will not lower than NT_VERSION_MIN_CONSTRAINED
 * 
 * Defined in "NT.h":
 *   GET_NT_VERSION: Get NT version number from `SharedUserData`
 *   IS_NT_VERSION_GE: Return whether NT_VERSION_MIN or GET_NT_VERSION is greater than or equal to the given NT version number
 */

#pragma once

#include <SdkDdkVer.h>

/* Patch undocumented NTDDI versions */
#define NTDDI_WIN10_GE NTDDI_WIN11_ZN /* Introduced in Windows SDK 10.0.26100.1 (Win11), later than all NTDDI_WIN10_* */
#define NTDDI_WIN11_DT NTDDI_WIN11_GE /* Introduced in Windows SDK 10.0.26100.3916, later than NTDDI_WIN11_GE */

#define NT_VERSION(Major, Minor, Build) (((((Major) & 0xFF) << 24) | (((Minor) & 0xFF) << 16)) | ((Build) & 0xFFFF))

#define NT_VERSION_WIN2K NT_VERSION(5, 0, 0)
#define NT_VERSION_WINXP NT_VERSION(5, 1, 0)
#define NT_VERSION_WS2K3 NT_VERSION(5, 2, 0)
#define NT_VERSION_VISTA NT_VERSION(6, 0, 0)
#define NT_VERSION_WIN7 NT_VERSION(6, 1, 0)
#define NT_VERSION_WIN8 NT_VERSION(6, 2, 0)
#define NT_VERSION_WINBLUE NT_VERSION(6, 3, 0)

#define NT_VERSION_WIN10 NT_VERSION(10, 0, 0)

#define NT_VERSION_WIN10_TH NT_VERSION(10, 0, 10240)
#define NT_VERSION_WIN10_1507 NT_VERSION_WIN10_TH

#define NT_VERSION_WIN10_TH2 NT_VERSION(10, 0, 10586)
#define NT_VERSION_WIN10_1511 NT_VERSION_WIN10_TH2

#define NT_VERSION_WIN10_RS1 NT_VERSION(10, 0, 14393)
#define NT_VERSION_WIN10_1607 NT_VERSION_WIN10_RS1

#define NT_VERSION_WIN10_RS2 NT_VERSION(10, 0, 15063)
#define NT_VERSION_WIN10_1703 NT_VERSION_WIN10_RS2

#define NT_VERSION_WIN10_RS3 NT_VERSION(10, 0, 16299)
#define NT_VERSION_WIN10_1709 NT_VERSION_WIN10_RS3

#define NT_VERSION_WIN10_RS4 NT_VERSION(10, 0, 17134)
#define NT_VERSION_WIN10_1803 NT_VERSION_WIN10_RS4

#define NT_VERSION_WIN10_RS5 NT_VERSION(10, 0, 17763)
#define NT_VERSION_WIN10_1809 NT_VERSION_WIN10_RS5

#define NT_VERSION_WIN10_19H1 NT_VERSION(10, 0, 18362)
#define NT_VERSION_WIN10_1903 NT_VERSION_WIN10_19H1

#define NT_VERSION_WIN10_19H2 NT_VERSION(10, 0, 18363)
#define NT_VERSION_WIN10_1909 NT_VERSION_WIN10_19H2

#define NT_VERSION_WIN10_20H1 NT_VERSION(10, 0, 19041)
#define NT_VERSION_WIN10_2004 NT_VERSION_WIN10_20H1

#define NT_VERSION_WIN10_20H2 NT_VERSION(10, 0, 19042)
#define NT_VERSION_WIN10_21H1 NT_VERSION(10, 0, 19043)
#define NT_VERSION_WIN10_21H2 NT_VERSION(10, 0, 19044)
#define NT_VERSION_WIN10_22H2 NT_VERSION(10, 0, 19045)

#define NT_VERSION_WIN11 NT_VERSION(10, 0, 22000)
#define NT_VERSION_WIN11_21H2 NT_VERSION_WIN11
#define NT_VERSION_WIN11_22H2 NT_VERSION(10, 0, 22621)
#define NT_VERSION_WIN11_23H2 NT_VERSION(10, 0, 22631)
#define NT_VERSION_WIN11_24H2 NT_VERSION(10, 0, 26100)
#define NT_VERSION_WIN11_25H2 NT_VERSION(10, 0, 26200)

/*  ARM support since NT10 */
#if defined(_M_ARM64) || defined(_M_ARM64EC) || defined(_M_ARM)
#define NT_VERSION_MIN_CONSTRAINED NT_VERSION_WIN10
#endif

/* Minimum support NT6.1 by default */
#ifndef NT_VERSION_MIN
#define NT_VERSION_MIN NT_VERSION_WIN7
#endif

/* Adjust NT_VERSION_MIN if it is lower than NT_VERSION_MIN_CONSTRAINED */
#if defined(NT_VERSION_MIN_CONSTRAINED) && (NT_VERSION_MIN < NT_VERSION_MIN_CONSTRAINED)
#undef NT_VERSION_MIN
#define NT_VERSION_MIN NT_VERSION_MIN_CONSTRAINED
#endif
